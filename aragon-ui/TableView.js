"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var defineProperty=require("./defineProperty-3cad0327.js"),slicedToArray=require("./slicedToArray-a8a77f0e.js"),_styled=require("styled-components"),React=require("react"),index=require("./index-37353731.js"),web=require("./web-46d746d6.js"),Layout=require("./Layout.js"),Checkbox=require("./Checkbox.js"),ToggleButton=require("./ToggleButton.js"),OpenedSurfaceBorder=require("./OpenedSurfaceBorder.js"),Theme=require("./Theme.js"),constants=require("./constants.js"),textStyles=require("./text-styles.js"),springs=require("./springs.js");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("./unsupportedIterableToArray-f175acfa.js"),require("./_commonjsHelpers-1b94f6bc.js"),require("./objectWithoutPropertiesLoose-1af20ad0.js"),require("react-dom"),require("./extends-023d783e.js"),require("./objectWithoutProperties-c6d3675c.js"),require("./Viewport-71f7efe6.js"),require("./getPrototypeOf-55c9e80c.js"),require("./_baseGetTag-6ec23aaa.js"),require("./breakpoints.js"),require("./css.js"),require("./FocusVisible.js"),require("./miscellaneous.js"),require("./theme-dark.js"),require("./theme-light.js"),require("./environment.js"),require("./color.js"),require("./toConsumableArray-cc0d28a9.js"),require("./ButtonIcon.js"),require("./Button.js"),require("./index-c33eeeef.js"),require("./ButtonBase.js"),require("./keycodes.js"),require("./font.js"),require("./IconUp.js"),require("./IconPropTypes-b9997416.js"),require("./IconDown.js");var _styled__default=_interopDefaultLegacy(_styled),React__default=_interopDefaultLegacy(React);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){defineProperty.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function headingsFromFields(e,t){var n=t.hasAnyActions,r=t.hasAnyExpansion,a=t.selectContent,l=t.selectable,i=e.map((function(e,t){return[e.label,"end"===e.align?"right":"left"]}));return(r||l)&&i.unshift([l?a:null,"left"]),n&&i.push([null,"left"]),i.every((function(e){return!e[0]}))?null:i}function cellsFromEntry(e,t){var n=t.fields,r=t.hasAnyActions,a=t.hasAnyExpansion,l=t.hasExpansion,i=t.selectContent,o=t.selectable,d=t.toggleChildContent,s=e.entryNodes.map((function(e,t){return[e,n[t].align,!1]}));return o&&s.unshift([i,"start",!0]),!o&&a&&s.unshift([l&&d,"start",!0]),r&&s.push([e.actions,"end",!0]),s}var _StyledTable=_styled__default.default("table").withConfig({displayName:"TableView___StyledTable",componentId:"aczwu3-0"})(["width:100%;border-spacing:0;border-collapse:separate;"]);function TableView(e){var t=e.alignChildOnField,n=e.allSelected,r=e.entries,a=e.fields,l=e.hasAnyActions,i=e.hasAnyExpansion,o=e.onSelect,d=e.onSelectAll,s=e.renderSelectionCount,c=e.rowHeight,u=e.selectable,f=e.selectedCount,_=React.useState(-1),p=slicedToArray.slicedToArray(_,2),y=p[0],h=p[1],g=React.useCallback((function(e){h((function(t){return t===e?-1:e}))}),[]),m=React.useMemo((function(){return headingsFromFields(a,{hasAnyActions:l,hasAnyExpansion:i,selectContent:React__default.default.createElement(Checkbox.default,{indeterminate:0===n,checked:n>-1,onChange:d}),selectable:u})}),[a,l,i,n,d,u]);return React__default.default.createElement(_StyledTable,null,m&&React__default.default.createElement("thead",null,React__default.default.createElement(HeadRow,{cells:m,selectedCount:f,renderSelectionCount:s})),React__default.default.createElement("tbody",null,r.map((function(e,n){return React__default.default.createElement(Entry,{key:e.index,alignChildOnField:t,entry:e,fields:a,firstRow:0===n,hasAnyActions:l,hasAnyExpansion:i,onSelect:o,onToggle:g,opened:y===e.index,rowHeight:c,selectable:u})}))))}function useSidePadding(){return"small"===Layout.useLayout().layoutName?2*constants.GU:3*constants.GU}TableView.propTypes={alignChildOnField:index.propTypes.number.isRequired,allSelected:index.propTypes.oneOf([-1,0,1]).isRequired,entries:index.propTypes.array.isRequired,fields:index.propTypes.array.isRequired,hasAnyActions:index.propTypes.bool.isRequired,hasAnyExpansion:index.propTypes.bool.isRequired,onSelect:index.propTypes.func.isRequired,onSelectAll:index.propTypes.func.isRequired,renderSelectionCount:index.propTypes.func.isRequired,rowHeight:index.propTypes.number.isRequired,selectable:index.propTypes.bool.isRequired,selectedCount:index.propTypes.number.isRequired};var _StyledTh=_styled__default.default("th").withConfig({displayName:"TableView___StyledTh",componentId:"aczwu3-1"})(["height:","px;padding:0;padding-left:","px;padding-right:","px;text-align:",";",";color:",";border-bottom:1px solid ",";"],(function(e){return e._css}),(function(e){return e._css2}),(function(e){return e._css3}),(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6}),(function(e){return e._css7}));function HeadRow(e){var t=e.cells,n=e.selectedCount,r=e.renderSelectionCount,a=Theme.useTheme(),l=useSidePadding();return React__default.default.createElement("tr",null,t.map((function(e,i){var o=n>0&&i>1,d=n>0&&1===i?r(n):e[0];return!o&&React__default.default.createElement(_StyledTh,{key:i,colSpan:n>0&&1===i?t.length-1:1,_css:4*constants.GU,_css2:0===i?l:0,_css3:i===t.length-1?l:0,_css4:e[1],_css5:textStyles.textStyle("label2"),_css6:a.surfaceContentSecondary,_css7:a.border},d)})))}var Entry=React__default.default.memo((function(e){var t=e.alignChildOnField,n=e.entry,r=e.fields,a=e.firstRow,l=e.hasAnyActions,i=e.hasAnyExpansion,o=e.onSelect,d=e.onToggle,s=e.opened,c=e.rowHeight,u=e.selectable,f=n.expansion.content.length>0,_=n.index,p=React.useCallback((function(){d(_)}),[_,d]),y=React.useCallback((function(e){o(_,e)}),[_,o]),h=cellsFromEntry(n,{fields:r,hasAnyActions:l,hasAnyExpansion:i,hasExpansion:f,selectable:u,toggleChildContent:i?React__default.default.createElement(Toggle,{opened:s,onToggle:p}):null,selectContent:u?React__default.default.createElement(Checkbox.default,{onChange:y,checked:n.selected}):null});return React__default.default.createElement(React__default.default.Fragment,null,React__default.default.createElement(EntryRow,{cells:h,firstRow:a,rowHeight:c,selected:n.selected}),f&&React__default.default.createElement(EntryExpansion,{alignChildOnCell:t+1,cellsCount:h.length,expansion:n.expansion,opened:s,rowHeight:c}))})),_StyledTr=_styled__default.default("tr").withConfig({displayName:"TableView___StyledTr",componentId:"aczwu3-2"})(["transition:background 150ms ease-in-out;background:",";"],(function(e){return e._css8})),_StyledTd=_styled__default.default("td").withConfig({displayName:"TableView___StyledTd",componentId:"aczwu3-3"})(["position:relative;width:",";height:","px;padding-top:0;padding-bottom:0;padding-left:","px;padding-right:","px;border-top:",";"],(function(e){return e._css9}),(function(e){return e._css10}),(function(e){return e._css11}),(function(e){return e._css12}),(function(e){return e._css13})),_StyledDiv=_styled__default.default("div").withConfig({displayName:"TableView___StyledDiv",componentId:"aczwu3-4"})(["display:flex;width:100%;justify-content:",";"],(function(e){return e._css14}));function EntryRow(e){var t=e.firstRow,n=e.cells,r=e.selected,a=e.rowHeight;e.mode;var l=Theme.useTheme(),i=useSidePadding();return React__default.default.createElement(_StyledTr,{_css8:r?l.surfaceSelected:"none"},n.map((function(e,n,r){var o=slicedToArray.slicedToArray(e,3),d=o[0],s=o[1],c=o[2],u=0===n,f=n===r.length-1;return React__default.default.createElement(_StyledTd,{key:n,_css9:c?"1px":"auto",_css10:a,_css11:u||c?i:0,_css12:!u&&("end"!==s||f)||c?i:0,_css13:t?"0":"1px solid ".concat(l.border)},React__default.default.createElement(_StyledDiv,{_css14:"flex-".concat(s)},d))})))}var _StyledTr2=_styled__default.default("tr").withConfig({displayName:"TableView___StyledTr2",componentId:"aczwu3-5"})(["td{position:relative;padding:0;box-shadow:inset 0 6px 4px -4px rgba(0,0,0,0.16);background:",";}"],(function(e){return e._css15})),_StyledAnimatedDiv=_styled__default.default(web.extendedAnimated.div).withConfig({displayName:"TableView___StyledAnimatedDiv",componentId:"aczwu3-6"})(["overflow:hidden"]),_StyledDiv2=_styled__default.default("div").withConfig({displayName:"TableView___StyledDiv2",componentId:"aczwu3-7"})(["height:",";border-top:1px solid ",";"],(function(e){return e._css16}),(function(e){return e._css17})),_StyledAnimatedDiv2=_styled__default.default(web.extendedAnimated.div).withConfig({displayName:"TableView___StyledAnimatedDiv2",componentId:"aczwu3-8"})(["overflow:hidden"]),_StyledDiv3=_styled__default.default("div").withConfig({displayName:"TableView___StyledDiv3",componentId:"aczwu3-9"})(["display:flex;align-items:center;height:",";padding-left:","px;padding-right:","px;border-top:1px solid ",";"],(function(e){return e._css18}),(function(e){return e._css19}),(function(e){return e._css20}),(function(e){return e._css21}));function EntryExpansion(e){var t=e.alignChildOnCell,n=e.cellsCount,r=e.expansion,a=e.opened,l=e.rowHeight,i=Theme.useTheme(),o=React.useState(0),d=slicedToArray.slicedToArray(o,2),s=d[0],c=d[1],u=function(e){e&&c(e.getBoundingClientRect().height)},f=r.freeLayout?s:l*r.content.length;return React__default.default.createElement(web.Transition,{native:!0,unique:!0,items:a,from:{height:0},enter:{height:f},update:{height:f},leave:{height:0},config:_objectSpread(_objectSpread({},springs.springs.smooth),{},{precision:.1})},(function(e){return e&&function(e){var o=e.height;return React__default.default.createElement(_StyledTr2,{_css15:i.surfaceUnder},t>0&&React__default.default.createElement("td",{colSpan:t},React__default.default.createElement(OpenedSurfaceBorder.OpenedSurfaceBorder,{opened:a}),React__default.default.createElement(_StyledAnimatedDiv,{style:{height:o.interpolate((function(e){return e!==f?"".concat(e,"px"):"auto"}))}},r.content.map((function(e,t){return React__default.default.createElement(_StyledDiv2,{key:t,_css16:r.freeLayout?"auto":"".concat(l,"px"),_css17:i.border})})))),React__default.default.createElement("td",{colSpan:-1===t?n:n-t},0===t&&React__default.default.createElement(OpenedSurfaceBorder.OpenedSurfaceBorder,{opened:a}),React__default.default.createElement(_StyledAnimatedDiv2,{style:{height:o.interpolate((function(e){return e!==f?"".concat(e,"px"):"auto"}))}},r.content.map((function(e,n){return React__default.default.createElement(_StyledDiv3,{key:n,ref:r.freeLayout?u:null,_css18:r.freeLayout?"auto":"".concat(l,"px"),_css19:t<1?3*constants.GU:0,_css20:3*constants.GU,_css21:i.border},e)})))))}}))}var _StyledDiv4=_styled__default.default("div").withConfig({displayName:"TableView___StyledDiv4",componentId:"aczwu3-10"})(["width:100%;height:100%;"]),Toggle=React__default.default.memo((function(e){var t=e.opened,n=e.onToggle;return React__default.default.createElement(_StyledDiv4,null,React__default.default.createElement(OpenedSurfaceBorder.OpenedSurfaceBorder,{opened:t}),React__default.default.createElement(ToggleButton.ToggleButton,{opened:t,onClick:n}))}));exports.TableView=TableView;