"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var defineProperty=require("./defineProperty-3cad0327.js"),toConsumableArray=require("./toConsumableArray-cc0d28a9.js"),slicedToArray=require("./slicedToArray-a8a77f0e.js"),_styled=require("styled-components"),React=require("react"),index=require("./index-37353731.js"),Box=require("./Box.js"),Pagination=require("./Pagination.js"),Layout=require("./Layout.js"),TableView=require("./TableView.js"),ListView=require("./ListView.js"),EmptyState=require("./EmptyState.js"),Theme=require("./Theme.js"),environment=require("./environment.js"),constants=require("./constants.js"),textStyles=require("./text-styles.js"),miscellaneous=require("./miscellaneous.js");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("./unsupportedIterableToArray-f175acfa.js"),require("./_commonjsHelpers-1b94f6bc.js"),require("./extends-023d783e.js"),require("./objectWithoutProperties-c6d3675c.js"),require("./index-c33eeeef.js"),require("./theme-dark.js"),require("./theme-light.js"),require("./color.js"),require("./getPrototypeOf-55c9e80c.js"),require("./Viewport-71f7efe6.js"),require("./_baseGetTag-6ec23aaa.js"),require("./breakpoints.js"),require("./css.js"),require("./font.js"),require("./PaginationItem.js"),require("./ButtonBase.js"),require("./FocusVisible.js"),require("./keycodes.js"),require("./PaginationSeparator.js"),require("./IconEllipsis.js"),require("./IconPropTypes-b9997416.js"),require("./web-46d746d6.js"),require("./objectWithoutPropertiesLoose-1af20ad0.js"),require("react-dom"),require("./Checkbox.js"),require("./springs.js"),require("./ToggleButton.js"),require("./ButtonIcon.js"),require("./Button.js"),require("./IconUp.js"),require("./IconDown.js"),require("./OpenedSurfaceBorder.js"),require("./LoadingRing.js"),require("./Link.js"),require("./PublicUrl-a6067988.js"),require("./getDisplayName-7f913e84.js"),require("./url.js");var _styled__default=_interopDefaultLegacy(_styled),React__default=_interopDefaultLegacy(React);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){defineProperty.defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function prepareEntries(e,t,r,n){return e.slice(t,r).map((function(e,r){var a=t+r;return{value:e||null,index:a,selected:n.includes(a)}}))}function prepareFields(e){return e.map((function(e,t,r){var n=e&&e.label?e:{label:e};return n.align||(n.align=t===r.length-1&&r.length>1?"end":"start"),n}))}function entryExpansion(e){return Array.isArray(e)&&e.length>0?{content:e,freeLayout:!1}:e&&!Array.isArray(e)?{content:[e],freeLayout:!0}:{content:[],freeLayout:!1}}function renderEntries(e,t){var r=t.fields,n=t.renderEntry,a=t.renderEntryActions,s=t.renderEntryExpansion,i=t.mode;return e.map((function(e){var t=e.value,o=e.index,l=e.selected,u=n(t,o,{selected:l,mode:i});for(Array.isArray(u)||(u=[]);u.length<r.length;)u.push(null);var d=entryExpansion(s?s(t,o,{selected:l,mode:i}):null);return{actions:a?a(t,o,{selected:l,mode:i}):null,entryNodes:u,expansion:d,index:o,selected:l}}))}function useSelection(e,t,r){var n=React.useState([]),a=slicedToArray.slicedToArray(n,2),s=a[0],i=a[1],o=void 0===t?s:t,l=React.useCallback((function(n){void 0===t&&i(n),r(toConsumableArray.toConsumableArray(n).sort().map((function(t){return e[t]})),n)}),[t,r,e]),u=React.useMemo((function(){return 0===o.length?-1:o.length===e.length?1:0}),[e,o]),d=React.useCallback((function(e){l(o.includes(e)?o.filter((function(t){return t!==e})):[].concat(toConsumableArray.toConsumableArray(o),[e]))}),[l,o]),c=React.useCallback((function(){l(0===o.length?e.map((function(e,t){return t})):[])}),[e,o,l]);return{allSelected:u,selectAll:c,toggleEntrySelect:d,selectedIndexes:o}}function deprecatedEmptyStatePropsCompat(e){for(var t=e.emptyState,r=e.statusEmpty,n=e.statusLoading,a=0,s=[["statusEmpty",r,"default","title"],["statusEmptyFilters",e.statusEmptyFilters,"empty-filters","subtitle"],["statusEmptySearch",e.statusEmptySearch,"empty-search","subtitle"],["statusLoading",n,"loading","title"]];a<s.length;a++){var i=slicedToArray.slicedToArray(s[a],4),o=i[0],l=i[1],u=i[2],d=i[3];l&&(environment.warnOnce("DataView:".concat(o),"DataView: the ".concat(o," prop is now deprecated, please use emptyState instead.")),t[u]&&t[u][d]||(t[u]=_objectSpread(_objectSpread({},t[u]),{},defineProperty.defineProperty({},d,l))))}return t}var _StyledDiv=_styled__default.default("div").withConfig({displayName:"DataView___StyledDiv",componentId:"sc-49otbs-0"})(["padding:","px ","px;"],(function(e){return e._css}),(function(e){return e._css2})),_StyledH=_styled__default.default("h1").withConfig({displayName:"DataView___StyledH",componentId:"sc-49otbs-1"})(["margin-bottom:","px;",";"],(function(e){return e._css3}),(function(e){return e._css4})),_StyledDiv2=_styled__default.default("div").withConfig({displayName:"DataView___StyledDiv2",componentId:"sc-49otbs-2"})(["border-top:1px solid ",";"],(function(e){return e._css5})),DataView=React__default.default.memo((function(e){var t=e.emptyState,r=e.entries,n=e.entriesPerPage,a=e.fields,s=e.heading,i=e.mode,o=e.onPageChange,l=e.onSelectEntries,u=e.onStatusEmptyClear,d=e.page,c=e.renderEntry,p=e.renderEntryActions,y=e.renderEntryExpansion,f=e.renderSelectionCount,m=e.selection,g=e.status,E=e.tableRowHeight,b=e.renderEntryChild,j=e.statusEmpty,h=e.statusEmptyFilters,_=e.statusEmptySearch,x=e.statusLoading;b&&!y&&(environment.warnOnce("DataView:renderEntryChild","DataView: the renderEntryChild prop has been renamed renderEntryExpansion and will be removed in a future version. Please use the new name."),y=b),y&&l&&(environment.warnOnce("DataView: renderEntryExpansion + onSelectEntries","A DataView cannot be made selectable with some of its entries expandable. Please use only one of renderEntryExpansion or onSelectEntries at a time. Ignoring renderEntryExpansion."),y=void 0),t=deprecatedEmptyStatePropsCompat({emptyState:t,statusEmpty:j,statusEmptyFilters:h,statusEmptySearch:_,statusLoading:x});var S=React.useState(0),q=slicedToArray.slicedToArray(S,2),w=q[0],T=q[1],v=React.useCallback((function(e){void 0===d&&T(e),o(e)}),[o,d]);React.useEffect((function(){T(0)}),[r]);var P=void 0===d?w:d,A=Theme.useTheme(),C=Layout.useLayout().layoutName,D="list"===i||"table"!==i&&"small"===C,O=useSelection(r,m,l),R=O.allSelected,V=O.selectAll,L=O.toggleEntrySelect,I=O.selectedIndexes,B=Boolean(p),k=Boolean(y),F=Boolean(l);n<1&&(n=r.length);var H=Math.ceil(r.length/n),U=n*P,G=prepareEntries(r,U,U+n,I),M=prepareFields(a),N=renderEntries(G,{fields:a,renderEntry:c,renderEntryActions:p,renderEntryExpansion:y,mode:D?"list":"table"}),K=a.findIndex((function(e){return e&&e.childStart})),W=0===N.length;return React__default.default.createElement(Box.default,{padding:0},s&&React__default.default.createElement(_StyledDiv,{_css:2*constants.GU,_css2:"small"===C?2*constants.GU:3*constants.GU},"string"==typeof s?React__default.default.createElement(_StyledH,{_css3:2*constants.GU,_css4:textStyles.textStyle("body2")},s):s),!W&&(D?React__default.default.createElement(ListView.ListView,{allSelected:R,entries:N,fields:M,hasAnyExpansion:k,onSelect:L,onSelectAll:V,renderSelectionCount:f,rowHeight:E,selectable:F}):React__default.default.createElement(TableView.TableView,{alignChildOnField:Math.min(Math.max(-1,K),a.length-1),allSelected:R,entries:N,fields:M,hasAnyActions:B,hasAnyExpansion:k,onSelect:L,onSelectAll:V,renderSelectionCount:f,rowHeight:E,selectable:F,selectedCount:I.length})),W&&React__default.default.createElement(EmptyState.default,{status:g,configurator:t,onStatusEmptyClear:u}),H>1&&React__default.default.createElement(_StyledDiv2,{_css5:A.border},React__default.default.createElement(Pagination.default,{pages:H,selected:P,onChange:v,touchMode:"small"===C})))}));DataView.propTypes={page:index.propTypes.number,entries:index.propTypes.array.isRequired,entriesPerPage:index.propTypes.number,fields:index.propTypes.array.isRequired,heading:index.propTypes.node,mode:index.propTypes.oneOf(["adaptive","table","list"]),onPageChange:index.propTypes.func,onSelectEntries:index.propTypes.func,renderEntry:index.propTypes.func.isRequired,renderEntryActions:index.propTypes.func,renderEntryExpansion:index.propTypes.func,renderSelectionCount:index.propTypes.func,selection:index.propTypes.array,tableRowHeight:index.propTypes.number,status:index.propTypes.oneOf(["default","empty-filters","empty-search","loading"]),onStatusEmptyClear:index.propTypes.func,emptyState:index.propTypes.oneOfType([index.propTypes.func,index.propTypes.object]),renderEntryChild:index.propTypes.func,statusEmpty:index.propTypes.node,statusLoading:index.propTypes.node,statusEmptyFilters:index.propTypes.node,statusEmptySearch:index.propTypes.node},DataView.defaultProps={emptyState:{},entriesPerPage:10,mode:"adaptive",onPageChange:miscellaneous.noop,renderSelectionCount:function(e){return"".concat(e," items selected")},status:"default",tableRowHeight:8*constants.GU},exports.default=DataView;