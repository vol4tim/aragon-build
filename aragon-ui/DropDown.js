"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=require("./extends-023d783e.js"),objectWithoutProperties=require("./objectWithoutProperties-c6d3675c.js"),slicedToArray=require("./slicedToArray-a8a77f0e.js"),_styled=require("styled-components"),React=require("react"),index$1=require("./index-37353731.js"),index=require("./index-c33eeeef.js"),Viewport=require("./Viewport-71f7efe6.js"),ButtonBase=require("./ButtonBase.js"),Popover=require("./Popover.js"),Theme=require("./Theme.js"),IconDown=require("./IconDown.js"),environment=require("./environment.js"),constants=require("./constants.js"),textStyles=require("./text-styles.js"),css=require("./css.js");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("./_commonjsHelpers-1b94f6bc.js"),require("./unsupportedIterableToArray-f175acfa.js"),require("./getPrototypeOf-55c9e80c.js"),require("./defineProperty-3cad0327.js"),require("./_baseGetTag-6ec23aaa.js"),require("./breakpoints.js"),require("./FocusVisible.js"),require("./keycodes.js"),require("./theme-dark.js"),require("./theme-light.js"),require("./color.js"),require("./toConsumableArray-cc0d28a9.js"),require("./miscellaneous.js"),require("./font.js"),require("./proptypes-316e1def.js"),require("./web-46d746d6.js"),require("./objectWithoutPropertiesLoose-1af20ad0.js"),require("react-dom"),require("./RootPortal.js"),require("./Root-07f851a6.js"),require("./springs.js"),require("./components.js"),require("./IconPropTypes-b9997416.js");var _styled__default=_interopDefaultLegacy(_styled),React__default=_interopDefaultLegacy(React),MIN_WIDTH=128;function useDropDown(e){var t=e.buttonRef,n=e.items,r=e.displayedLabel,s=e.onChange;e.placeholder;var o=e.selected,c=React.useState(r),a=slicedToArray.slicedToArray(c,2),i=a[0],d=a[1],l=React.useState(!1),u=slicedToArray.slicedToArray(l,2),p=u[0],f=u[1],_=React.useCallback((function(){f(!1),t.current&&t.current.focus()}),[t]),y=React.useCallback((function(){return f((function(e){return!e}))}),[]),m=React.useCallback((function(e){s(e),_()}),[s,_]);return React.useEffect((function(){-1!==o&&n[o]?d(n[o]):r&&d(r)}),[n,o,r]),{handleItemSelect:m,close:_,toggle:y,opened:p,selectedLabel:i}}function useButtonRef(e){var t=React.useRef(null),n=React.useCallback((function(n){n&&e(n),t.current=n}),[e]);return{buttonRef:t,refCallback:n}}var _StyledButtonBase=_styled__default.default(ButtonBase.default).withConfig({displayName:"DropDown___StyledButtonBase",componentId:"sc-17zpefi-0"})(["display:",";justify-content:space-between;align-items:center;height:","px;padding-left:","px;padding-right:","px;width:",";min-width:",";background:",";color:",";border:","px solid ",";",";",""],(function(e){return e._css}),(function(e){return e._css2}),(function(e){return e._css3}),(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6}),(function(e){return e._css7}),(function(e){return e._css8}),(function(e){return e._css9}),(function(e){return e._css10}),(function(e){return e._css11}),(function(e){return e._css12})),_StyledDiv=_styled__default.default("div").withConfig({displayName:"DropDown___StyledDiv",componentId:"sc-17zpefi-1"})(["overflow:hidden;"]),_StyledIconDown=_styled__default.default(IconDown.default).withConfig({displayName:"DropDown___StyledIconDown",componentId:"sc-17zpefi-2"})(["margin-left:","px;color:",";"],(function(e){return e._css13}),(function(e){return e._css14})),_StyledDiv2=_styled__default.default("div").withConfig({displayName:"DropDown___StyledDiv2",componentId:"sc-17zpefi-3"})(["position:absolute;top:-100vh;left:-100vw;opacity:0;visibility:hidden;"]),DropDown=React__default.default.memo((function(e){var t=e.disabled,n=e.header,r=e.items,s=e.onChange,o=e.placeholder,c=e.renderLabel,a=e.selected,i=e.wide,d=e.width,l=e.active,u=e.label,p=objectWithoutProperties.objectWithoutProperties(e,["disabled","header","items","onChange","placeholder","renderLabel","selected","wide","width","active","label"]);void 0!==l&&environment.warnOnce("DropDown:active","The “active” prop is deprecated. Please use “selected” to pass the selected index instead."),void 0!==u&&environment.warnOnce("DropDown:label","DropDown: the “label” prop is deprecated, please use “placeholder” instead.");var f=Theme.useTheme(),_=Viewport.useViewport().width,y=(d||"").split("px"),m=slicedToArray.slicedToArray(y,1)[0],b=void 0===m?MIN_WIDTH:m,h=React.useState(0),x=slicedToArray.slicedToArray(h,2),R=x[0],D=x[1],v=React.useState(!0),w=slicedToArray.slicedToArray(v,2),T=w[0],q=w[1],S=React.useState(Math.min(b,MIN_WIDTH)),g=slicedToArray.slicedToArray(S,2),j=g[0],I=g[1],C=React.useCallback((function(e){e&&(I(e.clientWidth),q(!1))}),[]);React.useEffect((function(){q(!0)}),[_,r]);var $=useButtonRef((function(e){D(e.clientWidth)})),P=$.refCallback,k=$.buttonRef;React.useEffect((function(){k.current&&D(k.current.clientWidth)}),[k,_]);var B=React.useMemo((function(){return void 0!==a?a:void 0!==l?l:-1}),[l,a]),A=useDropDown({buttonRef:k,displayedLabel:o||u,items:r,onChange:s,selected:a}),E=A.handleItemSelect,U=A.close,W=A.toggle,L=A.opened,N=A.selectedLabel,G=!L&&-1!==B,z=c;return React__default.default.createElement(index.i,{name:"DropDown"},React__default.default.createElement(_StyledButtonBase,_extends._extends_1({ref:P,disabled:t,onClick:W,focusRingRadius:constants.RADIUS,focusRingSpacing:1},p,{_css:i?"flex":"inline-flex",_css2:5*constants.GU,_css3:2*constants.GU,_css4:1.5*constants.GU,_css5:d||(i?"100%":"auto"),_css6:i?"auto":"".concat(j,"px"),_css7:t?f.disabled:f.surface,_css8:t?f.disabledContent:f.surfaceContent,_css9:t?0:1,_css10:G?f.selected:f.border,_css11:textStyles.textStyle("body2"),_css12:t?"font-weight: 600;":"\n              &:active {\n                background: ".concat(f.surfacePressed,";\n              }\n            ")}),React__default.default.createElement(_StyledDiv,null,React__default.default.createElement(z,{selectedIndex:B,selectedLabel:N})),React__default.default.createElement(_StyledIconDown,{size:"tiny",_css13:1.5*constants.GU,_css14:t?f.disabledIcon:G?f.accent:f.surfaceIcon})),T&&React__default.default.createElement(_StyledDiv2,null,React__default.default.createElement(PopoverContent,{refCallback:C,buttonWidth:R,header:n,items:r})),React__default.default.createElement(Popover.default,{onClose:U,opener:k.current,visible:L},React__default.default.createElement(PopoverContent,{buttonWidth:R,header:n,items:r,handleItemSelect:E,selectedIndex:B})))}));DropDown.propTypes={disabled:index$1.propTypes.bool,header:index$1.propTypes.node,items:index$1.propTypes.arrayOf(index$1.propTypes.node).isRequired,onChange:index$1.propTypes.func.isRequired,placeholder:index$1.propTypes.node,renderLabel:index$1.propTypes.func,selected:index$1.propTypes.number,wide:index$1.propTypes.bool,width:index$1.propTypes.string,active:index$1.propTypes.number,label:index$1.propTypes.string},DropDown.defaultProps={placeholder:"Select an item",renderLabel:function(e){return e.selectedLabel},wide:!1};var _StyledDiv3=_styled__default.default("div").withConfig({displayName:"DropDown___StyledDiv3",componentId:"sc-17zpefi-4"})(["min-width:","px;color:",";"],(function(e){return e._css15}),(function(e){return e._css16})),_StyledDiv4=_styled__default.default("div").withConfig({displayName:"DropDown___StyledDiv4",componentId:"sc-17zpefi-5"})(["padding:","px ","px ","px;",";",";"],(function(e){return e._css17}),(function(e){return e._css18}),(function(e){return e._css19}),(function(e){return e._css20}),css.unselectable),_StyledUl=_styled__default.default("ul").withConfig({displayName:"DropDown___StyledUl",componentId:"sc-17zpefi-6"})(["margin:0;padding:0;list-style:none;width:100%;"]),PopoverContent=React__default.default.memo((function(e){var t=e.refCallback,n=e.buttonWidth,r=e.header,s=e.items,o=e.handleItemSelect,c=e.selectedIndex,a=Theme.useTheme();return React__default.default.createElement(_StyledDiv3,{_css15:n,_css16:a.surfaceContentSecondary},r&&React__default.default.createElement(_StyledDiv4,{_css17:1.5*constants.GU,_css18:2*constants.GU,_css19:1.25*constants.GU,_css20:textStyles.textStyle("label2")},r),React__default.default.createElement(_StyledUl,{ref:t},React__default.default.createElement(index.i,{name:"DropDown:menu"},s.map((function(e,t){return React__default.default.createElement(Item,{key:t,index:t,onSelect:o,theme:a,item:e,header:r,length:s.length,selected:c})})))))}));PopoverContent.propTypes={refCallback:index$1.propTypes.func.isRequired,buttonWidth:index$1.propTypes.number.isRequired,header:index$1.propTypes.node,items:index$1.propTypes.array.isRequired,handleItemSelect:index$1.propTypes.func.isRequired,selectedIndex:index$1.propTypes.number.isRequired},PopoverContent.defaultProps={refCallback:function(){return null},handleItemSelect:function(){return null},selectedIndex:-1};var _StyledButtonBase2=_styled__default.default(ButtonBase.default).withConfig({displayName:"DropDown___StyledButtonBase2",componentId:"sc-17zpefi-7"})(["width:100%;text-align:left;padding:","px ","px;border-radius:0;color:",";",";"," "," "," &:active{background:",";}"],(function(e){return e._css21}),(function(e){return e._css22}),(function(e){return e._css23}),(function(e){return e._css24}),(function(e){return e._css25}),(function(e){return e._css26}),(function(e){return e._css27}),(function(e){return e._css28})),Item=React__default.default.memo((function(e){var t=e.header,n=e.index,r=e.item,s=e.length,o=e.onSelect,c=e.selected,a=e.theme,i=React.useCallback((function(){o(n)}),[n,o]);return React__default.default.createElement("li",null,React__default.default.createElement(_StyledButtonBase2,{onClick:i,_css21:1.25*constants.GU,_css22:2*constants.GU,_css23:a.content,_css24:textStyles.textStyle("body2"),_css25:t||0!==n?"":"border-top-left-radius: ".concat(constants.RADIUS,"px;"),_css26:n===s-1?"border-bottom-left-radius: ".concat(constants.RADIUS,"px;"):"",_css27:c===n?"\n              border-left: 2px solid ".concat(a.accent,";\n              background: ").concat(a.surfaceSelected,";\n            "):"",_css28:a.surfacePressed},r))}));Item.propTypes={header:index$1.propTypes.node,index:index$1.propTypes.number.isRequired,item:index$1.propTypes.node.isRequired,length:index$1.propTypes.number.isRequired,onSelect:index$1.propTypes.func.isRequired,selected:index$1.propTypes.number.isRequired,theme:index$1.propTypes.object.isRequired},exports.default=DropDown;