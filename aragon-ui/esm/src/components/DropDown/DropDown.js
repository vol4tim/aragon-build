import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import objectWithoutProperties from"../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useState,useCallback,useEffect,useMemo,useRef}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import{Inside as i}from"../../../node_modules/use-inside/dist/index.js";import{useViewport}from"../../providers/Viewport/Viewport.js";import ButtonBaseWithFocus from"../ButtonBase/ButtonBase.js";import Popover from"../Popover/Popover.js";import{useTheme}from"../../theme/Theme2.js";import IconDown from"../../icons/components/IconDown.js";import{warnOnce}from"../../utils/environment.js";import{RADIUS,GU}from"../../style/constants.js";import{textStyle}from"../../style/text-styles.js";import{unselectable}from"../../utils/css.js";var MIN_WIDTH=128;function useDropDown(e){var t=e.buttonRef,n=e.items,o=e.displayedLabel,s=e.onChange;e.placeholder;var r=e.selected,c=useState(o),i=slicedToArray(c,2),l=i[0],d=i[1],a=useState(!1),u=slicedToArray(a,2),p=u[0],f=u[1],m=useCallback((function(){f(!1),t.current&&t.current.focus()}),[t]),_=useCallback((function(){return f((function(e){return!e}))}),[]),y=useCallback((function(e){s(e),m()}),[s,m]);return useEffect((function(){-1!==r&&n[r]?d(n[r]):o&&d(o)}),[n,r,o]),{handleItemSelect:y,close:m,toggle:_,opened:p,selectedLabel:l}}function useButtonRef(e){var t=useRef(null),n=useCallback((function(n){n&&e(n),t.current=n}),[e]);return{buttonRef:t,refCallback:n}}var _StyledButtonBase=_styled(ButtonBaseWithFocus).withConfig({displayName:"DropDown___StyledButtonBase",componentId:"sc-17zpefi-0"})(["display:",";justify-content:space-between;align-items:center;height:","px;padding-left:","px;padding-right:","px;width:",";min-width:",";background:",";color:",";border:","px solid ",";",";",""],(function(e){return e._css}),(function(e){return e._css2}),(function(e){return e._css3}),(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6}),(function(e){return e._css7}),(function(e){return e._css8}),(function(e){return e._css9}),(function(e){return e._css10}),(function(e){return e._css11}),(function(e){return e._css12})),_StyledDiv=_styled("div").withConfig({displayName:"DropDown___StyledDiv",componentId:"sc-17zpefi-1"})(["overflow:hidden;"]),_StyledIconDown=_styled(IconDown).withConfig({displayName:"DropDown___StyledIconDown",componentId:"sc-17zpefi-2"})(["margin-left:","px;color:",";"],(function(e){return e._css13}),(function(e){return e._css14})),_StyledDiv2=_styled("div").withConfig({displayName:"DropDown___StyledDiv2",componentId:"sc-17zpefi-3"})(["position:absolute;top:-100vh;left:-100vw;opacity:0;visibility:hidden;"]),DropDown=React.memo((function(e){var t=e.disabled,n=e.header,o=e.items,s=e.onChange,r=e.placeholder,c=e.renderLabel,l=e.selected,d=e.wide,a=e.width,u=e.active,p=e.label,f=objectWithoutProperties(e,["disabled","header","items","onChange","placeholder","renderLabel","selected","wide","width","active","label"]);void 0!==u&&warnOnce("DropDown:active","The “active” prop is deprecated. Please use “selected” to pass the selected index instead."),void 0!==p&&warnOnce("DropDown:label","DropDown: the “label” prop is deprecated, please use “placeholder” instead.");var m=useTheme(),_=useViewport().width,y=(a||"").split("px"),h=slicedToArray(y,1)[0],b=void 0===h?MIN_WIDTH:h,D=useState(0),v=slicedToArray(D,2),w=v[0],S=v[1],R=useState(!0),T=slicedToArray(R,2),g=T[0],I=T[1],x=useState(Math.min(b,MIN_WIDTH)),C=slicedToArray(x,2),B=C[0],k=C[1],E=useCallback((function(e){e&&(k(e.clientWidth),I(!1))}),[]);useEffect((function(){I(!0)}),[_,o]);var j=useButtonRef((function(e){S(e.clientWidth)})),P=j.refCallback,U=j.buttonRef;useEffect((function(){U.current&&S(U.current.clientWidth)}),[U,_]);var W=useMemo((function(){return void 0!==l?l:void 0!==u?u:-1}),[u,l]),q=useDropDown({buttonRef:U,displayedLabel:r||p,items:o,onChange:s,selected:l}),A=q.handleItemSelect,N=q.close,G=q.toggle,L=q.opened,z=q.selectedLabel,M=!L&&-1!==W,O=c;return React.createElement(i,{name:"DropDown"},React.createElement(_StyledButtonBase,_extends_1({ref:P,disabled:t,onClick:G,focusRingRadius:RADIUS,focusRingSpacing:1},f,{_css:d?"flex":"inline-flex",_css2:5*GU,_css3:2*GU,_css4:1.5*GU,_css5:a||(d?"100%":"auto"),_css6:d?"auto":"".concat(B,"px"),_css7:t?m.disabled:m.surface,_css8:t?m.disabledContent:m.surfaceContent,_css9:t?0:1,_css10:M?m.selected:m.border,_css11:textStyle("body2"),_css12:t?"font-weight: 600;":"\n              &:active {\n                background: ".concat(m.surfacePressed,";\n              }\n            ")}),React.createElement(_StyledDiv,null,React.createElement(O,{selectedIndex:W,selectedLabel:z})),React.createElement(_StyledIconDown,{size:"tiny",_css13:1.5*GU,_css14:t?m.disabledIcon:M?m.accent:m.surfaceIcon})),g&&React.createElement(_StyledDiv2,null,React.createElement(PopoverContent,{refCallback:E,buttonWidth:w,header:n,items:o})),React.createElement(Popover,{onClose:N,opener:U.current,visible:L},React.createElement(PopoverContent,{buttonWidth:w,header:n,items:o,handleItemSelect:A,selectedIndex:W})))}));DropDown.propTypes={disabled:propTypes.bool,header:propTypes.node,items:propTypes.arrayOf(propTypes.node).isRequired,onChange:propTypes.func.isRequired,placeholder:propTypes.node,renderLabel:propTypes.func,selected:propTypes.number,wide:propTypes.bool,width:propTypes.string,active:propTypes.number,label:propTypes.string},DropDown.defaultProps={placeholder:"Select an item",renderLabel:function(e){return e.selectedLabel},wide:!1};var _StyledDiv3=_styled("div").withConfig({displayName:"DropDown___StyledDiv3",componentId:"sc-17zpefi-4"})(["min-width:","px;color:",";"],(function(e){return e._css15}),(function(e){return e._css16})),_StyledDiv4=_styled("div").withConfig({displayName:"DropDown___StyledDiv4",componentId:"sc-17zpefi-5"})(["padding:","px ","px ","px;",";",";"],(function(e){return e._css17}),(function(e){return e._css18}),(function(e){return e._css19}),(function(e){return e._css20}),unselectable),_StyledUl=_styled("ul").withConfig({displayName:"DropDown___StyledUl",componentId:"sc-17zpefi-6"})(["margin:0;padding:0;list-style:none;width:100%;"]),PopoverContent=React.memo((function(e){var t=e.refCallback,n=e.buttonWidth,o=e.header,s=e.items,r=e.handleItemSelect,c=e.selectedIndex,l=useTheme();return React.createElement(_StyledDiv3,{_css15:n,_css16:l.surfaceContentSecondary},o&&React.createElement(_StyledDiv4,{_css17:1.5*GU,_css18:2*GU,_css19:1.25*GU,_css20:textStyle("label2")},o),React.createElement(_StyledUl,{ref:t},React.createElement(i,{name:"DropDown:menu"},s.map((function(e,t){return React.createElement(Item,{key:t,index:t,onSelect:r,theme:l,item:e,header:o,length:s.length,selected:c})})))))}));PopoverContent.propTypes={refCallback:propTypes.func.isRequired,buttonWidth:propTypes.number.isRequired,header:propTypes.node,items:propTypes.array.isRequired,handleItemSelect:propTypes.func.isRequired,selectedIndex:propTypes.number.isRequired},PopoverContent.defaultProps={refCallback:function(){return null},handleItemSelect:function(){return null},selectedIndex:-1};var _StyledButtonBase2=_styled(ButtonBaseWithFocus).withConfig({displayName:"DropDown___StyledButtonBase2",componentId:"sc-17zpefi-7"})(["width:100%;text-align:left;padding:","px ","px;border-radius:0;color:",";",";"," "," "," &:active{background:",";}"],(function(e){return e._css21}),(function(e){return e._css22}),(function(e){return e._css23}),(function(e){return e._css24}),(function(e){return e._css25}),(function(e){return e._css26}),(function(e){return e._css27}),(function(e){return e._css28})),Item=React.memo((function(e){var t=e.header,n=e.index,o=e.item,s=e.length,r=e.onSelect,c=e.selected,i=e.theme,l=useCallback((function(){r(n)}),[n,r]);return React.createElement("li",null,React.createElement(_StyledButtonBase2,{onClick:l,_css21:1.25*GU,_css22:2*GU,_css23:i.content,_css24:textStyle("body2"),_css25:t||0!==n?"":"border-top-left-radius: ".concat(RADIUS,"px;"),_css26:n===s-1?"border-bottom-left-radius: ".concat(RADIUS,"px;"):"",_css27:c===n?"\n              border-left: 2px solid ".concat(i.accent,";\n              background: ").concat(i.surfaceSelected,";\n            "):"",_css28:i.surfacePressed},o))}));Item.propTypes={header:propTypes.node,index:propTypes.number.isRequired,item:propTypes.node.isRequired,length:propTypes.number.isRequired,onSelect:propTypes.func.isRequired,selected:propTypes.number.isRequired,theme:propTypes.object.isRequired};export default DropDown;