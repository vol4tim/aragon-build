import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useRef,useState,useEffect,useCallback,useMemo}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import dayjs_min from"../../../node_modules/dayjs/dayjs.min.js";import ButtonWithRef from"../Button/Button.js";import{useViewport}from"../../providers/Viewport/Viewport.js";import DatePicker from"./DatePicker.js";import Labels from"./Labels.js";import{START_DATE,END_DATE}from"./consts.js";import{handleDateSelect}from"./utils.js";import Popover from"../Popover/Popover.js";import{useTheme}from"../../theme/Theme2.js";import{RADIUS,GU}from"../../style/constants.js";var _StyledPopover=_styled(Popover).withConfig({displayName:"DateRangePicker___StyledPopover",componentId:"s3s5m9-0"})(["min-width:","px;border:0;filter:none;background:none;margin:2px 0 0 0;"],(function(e){return e._css})),_StyledDiv=_styled("div").withConfig({displayName:"DateRangePicker___StyledDiv",componentId:"s3s5m9-1"})(["padding:","px ","px ","px;border:1px solid ",";border-radius:","px;background:",";"],(function(e){return e._css2}),(function(e){return e._css3}),(function(e){return e._css4}),(function(e){return e._css5}),RADIUS,(function(e){return e._css6})),_StyledDiv2=_styled("div").withConfig({displayName:"DateRangePicker___StyledDiv2",componentId:"s3s5m9-2"})(["display:flex;flex-direction:row;align-items:baseline;"]),_StyledDatePicker=_styled(DatePicker).withConfig({displayName:"DateRangePicker___StyledDatePicker",componentId:"s3s5m9-3"})(["margin-left:","px;"],(function(e){return e._css7})),_StyledDiv3=_styled("div").withConfig({displayName:"DateRangePicker___StyledDiv3",componentId:"s3s5m9-4"})(["display:flex;align-items:center;justify-content:space-between;margin-top:","px;",";"],(function(e){return e._css8}),(function(e){return e._css9})),_StyledButton=_styled(ButtonWithRef).withConfig({displayName:"DateRangePicker___StyledButton",componentId:"s3s5m9-5"})(["margin-left:","px;"],(function(e){return e._css10}));function DateRangePicker(e){var t=e.format,n=e.endDate,a=e.onChange,s=e.startDate,r=useTheme(),o=useRef(),i=useState(!1),c=slicedToArray(i,2),l=c[0],d=c[1],m=useState(s),u=slicedToArray(m,2),p=u[0],_=u[1],f=useState(n),y=slicedToArray(f,2),D=y[0],g=y[1];useEffect((function(){l||(_(s),g(n))}),[n,s,l]);var R=useCallback((function(){return d(!1)}),[]),S=useCallback((function(){d((function(e){return!e}))}),[]),v=useCallback((function(e){var t=handleDateSelect({date:e,startDate:p,endDate:D});void 0!==t.startDate&&_(t.startDate),void 0!==t.endDate&&g(t.endDate)}),[p,D]),k=useCallback((function(){d(!1),p&&D&&a({start:dayjs_min(p).startOf("day").toDate(),end:dayjs_min(D).endOf("day").toDate()})}),[D,a,p]),b=useCallback((function(){_(null),g(null),d(!1),a({start:null,end:null})}),[a]),h=useMemo((function(){var e=l?p:s,a=l?D:n;return{startText:e?dayjs_min(e).format(t):START_DATE,endText:a?dayjs_min(a).format(t):END_DATE}}),[D,n,t,l,p,s]),j=useViewport().below("medium"),P=useMemo((function(){var e=s&&n&&dayjs_min(s).isSame(dayjs_min(n),"month");return!j&&(e||!s)}),[j,n,s]);return React.createElement("div",null,React.createElement(Labels,_extends_1({ref:o,enabled:l,hasSetDates:Boolean(s&&n),onClick:S},h)),React.createElement(_StyledPopover,{closeOnOpenerFocus:!0,onClose:R,opener:o.current,placement:"bottom-start",visible:l,_css:37.5*GU+2},React.createElement(_StyledDiv,{_css2:2.5*GU,_css3:3*GU,_css4:3*GU,_css5:r.border,_css6:r.surface},React.createElement(_StyledDiv2,null,React.createElement(DatePicker,{datesRangeEnd:D,datesRangeStart:p,initialDate:dayjs_min(s||void 0).subtract(P?1:0,"month").toDate(),onSelect:v}),!j&&React.createElement(_StyledDatePicker,{datesRangeEnd:D,datesRangeStart:p,initialDate:dayjs_min(n||void 0).toDate(),onSelect:v,_css7:1*GU})),React.createElement(_StyledDiv3,{_css8:2.25*GU,_css9:j?"":"\n                    max-width: 247px;\n                    margin-left: auto;\n                  "},React.createElement(ButtonWithRef,{onClick:b,size:"small",wide:!0},"Reset"),React.createElement(_StyledButton,{disabled:!p||!D,mode:"strong",onClick:k,size:"small",wide:!0,_css10:1.5*GU},"Apply")))))}DateRangePicker.propTypes={endDate:propTypes.instanceOf(Date),format:propTypes.string,onChange:propTypes.func,startDate:propTypes.instanceOf(Date)},DateRangePicker.defaultProps={format:"MM/DD/YYYY",onChange:function(){}};export default DateRangePicker;