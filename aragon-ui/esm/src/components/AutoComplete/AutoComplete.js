import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useState,useRef,useCallback,useEffect}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import{animated as extendedAnimated,Transition}from"../../../node_modules/react-spring/web.js";import ButtonBaseWithFocus from"../ButtonBase/ButtonBase.js";import SearchInput from"../Input/SearchInput.js";import{useArrowKeysFocus}from"../../hooks/useArrowKeysFocus.js";import{useClickOutside}from"../../hooks/useClickOutside.js";import{useKeyDown}from"../../hooks/useKeyDown.js";import{useTheme}from"../../theme/Theme2.js";import{noop,identity}from"../../utils/miscellaneous.js";import{useFocusLeave}from"../../hooks/useFocusLeave.js";import{KEY_ESC}from"../../utils/keycodes.js";import{springs}from"../../style/springs.js";import{unselectable}from"../../utils/css.js";var _StyledDiv=_styled("div").withConfig({displayName:"AutoComplete___StyledDiv",componentId:"bpnxyo-0"})(["position:relative"]);function AutoComplete(e){var t=e.forwardedRef,o=e.itemButtonStyles,r=void 0===o?"":o,n=e.items,s=void 0===n?[]:n,i=e.onSelect,u=void 0===i?noop:i,a=e.onChange,l=void 0===a?noop:a,c=e.placeholder,d=e.renderItem,p=void 0===d?identity:d,m=e.required,f=e.value,y=e.wide,_=t,h=new Set(s),b=useState(!0),g=slicedToArray(b,2),x=g[0],C=g[1],v=useRef(),S=useRef([]),w=useCallback((function(){return C(!1)}),[]),R=useCallback((function(){return C(!0)}),[]),A=useCallback((function(e){u(e),C(!1)}),[u]),T=useCallback((function(){C(!0),l.apply(void 0,arguments)}),[l]),k=useFocusLeave(w,v).handleFocusLeave,B=useArrowKeysFocus(S),j=B.highlightedIndex,I=B.setHighlightedIndex;return useClickOutside(w,v),useKeyDown(KEY_ESC,w),useEffect((function(){I(-1)}),[x,s,f,I]),React.createElement(_StyledDiv,{ref:v,onBlur:k},React.createElement(SearchInput,{ref:_,wide:y,placeholder:c,required:m,onChange:T,onFocus:R,value:f}),React.createElement(Transition,{config:springs.swift,items:x&&s.length>0,from:{scale:.98,opacity:0},enter:{scale:1,opacity:1},leave:{scale:1,opacity:0},native:!0},(function(e){return e&&function(e){var t=e.scale,o=e.opacity;return React.createElement(Items,{style:{opacity:o,transform:t.interpolate((function(e){return"scale3d(".concat(e,",").concat(e,",1)")}))}},Array.from(h).map((function(e,t){return React.createElement(Item,{key:e.key||e,ref:function(e){return S.current[t]=e},index:t,item:e,itemButtonStyles:r,onHighlight:I,onSelect:A,selected:t===j},p(e,f))})))}})))}AutoComplete.propTypes={forwardedRef:propTypes.object,itemButtonStyles:propTypes.string,items:propTypes.array.isRequired,onSelect:propTypes.func.isRequired,onChange:propTypes.func.isRequired,placeholder:propTypes.string,renderItem:propTypes.func,required:propTypes.bool,value:propTypes.string,wide:propTypes.bool};var _StyledLi=_styled("li").withConfig({displayName:"AutoComplete___StyledLi",componentId:"bpnxyo-1"})(["overflow:hidden;cursor:pointer;",";"],(function(e){return e._css})),_StyledButtonBase=_styled(ButtonBaseWithFocus).withConfig({displayName:"AutoComplete___StyledButtonBase",componentId:"bpnxyo-2"})(["text-align:left;padding:4px 8px;width:100%;border-radius:0;border-left:3px solid transparent;cursor:pointer;",";",";"],(function(e){return e._css2}),(function(e){return e._css3})),Item=React.forwardRef((function(e,t){var o=e.children,r=e.index,n=e.item,s=e.itemButtonStyles,i=e.onHighlight,u=e.onSelect,a=e.selected,l=useTheme(),c=useCallback((function(e){e.preventDefault(),u(n)}),[n,u]),d=useCallback((function(){i(r)}),[r,i]);return React.createElement(_StyledLi,{role:"option",_css:unselectable()},React.createElement(_StyledButtonBase,{ref:t,onClick:c,onFocus:d,onMouseOver:d,_css2:a?"\n                outline: 2px solid ".concat(l.accent,";\n                background: ").concat(l.surfaceHighlight,";\n                border-left: 3px solid ").concat(l.accent,";\n              "):"",_css3:s},o))})),_StyledAnimatedUl=_styled(extendedAnimated.ul).withConfig({displayName:"AutoComplete___StyledAnimatedUl",componentId:"bpnxyo-3"})(["position:absolute;z-index:2;top:100%;width:100%;padding:8px 0;color:",";background:",";border:1px solid ",";box-shadow:0 4px 4px 0 rgba(0,0,0,0.06);border-radius:3px;padding:0;margin:0;list-style:none;& > li:first-child{border-top-left-radius:3px;border-top-right-radius:3px;}& > li:last-child{border-bottom-left-radius:3px;border-bottom-right-radius:3px;}"],(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6})),Items=function(e){var t=useTheme();return React.createElement(_StyledAnimatedUl,_extends_1({role:"listbox"},e,{_css4:t.surfaceContent,_css5:t.surface,_css6:t.border}))},AutoCompleteMemo=React.memo(AutoComplete),AutoComplete$1=React.forwardRef((function(e,t){return React.createElement(AutoCompleteMemo,_extends_1({},e,{forwardedRef:t}))}));export default AutoComplete$1;