import toConsumableArray from"../../../node_modules/@babel/runtime/helpers/toConsumableArray.js";import objectWithoutProperties from"../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js";import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import classCallCheck from"../../../node_modules/@babel/runtime/helpers/classCallCheck.js";import createClass from"../../../node_modules/@babel/runtime/helpers/createClass.js";import assertThisInitialized from"../../../node_modules/@babel/runtime/helpers/assertThisInitialized.js";import inherits from"../../../node_modules/@babel/runtime/helpers/inherits.js";import possibleConstructorReturn from"../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js";import getPrototypeOf from"../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js";import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import _styled from"styled-components";import React from"react";import ExtendedPropTypes from"../../proptypes.js";import Popper from"../../../node_modules/popper.js/dist/esm/popper.js";import{animated as extendedAnimated,Transition}from"../../../node_modules/react-spring/web.js";import RootPortal from"../RootPortal/RootPortal.js";import{useTheme}from"../../theme/Theme2.js";import{useRoot}from"../../providers/Root/Root.js";import{KEY_ESC}from"../../utils/keycodes.js";import{RADIUS,GU}from"../../style/constants.js";import{springs}from"../../style/springs.js";import{warn}from"../../utils/environment.js";import{stylingProps}from"../../utils/components.js";import{noop}from"../../utils/miscellaneous.js";var _ref3;function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach((function(t){defineProperty(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,r=getPrototypeOf(e);if(t){var n=getPrototypeOf(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return possibleConstructorReturn(this,o)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var _StyledAnimatedDiv=_styled(extendedAnimated.div).withConfig({displayName:"Popover___StyledAnimatedDiv",componentId:"sc-1hohxqp-0"})(["position:absolute;top:0;left:0;"]),_StyledAnimatedDiv2=_styled(extendedAnimated.div).withConfig({displayName:"Popover___StyledAnimatedDiv2",componentId:"sc-1hohxqp-1"})(["background:",";border:1px solid ",";border-radius:","px;filter:drop-shadow(0 4px 4px rgba(0,0,0,0.15));&:focus{outline:0;}overflow-y:auto;"],(function(e){return e._css}),(function(e){return e._css2}),RADIUS),PopoverBase=function(e){inherits(o,e);var t=_createSuper(o);function o(){var e;classCallCheck(this,o);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n)),defineProperty(assertThisInitialized(e),"_cardElement",React.createRef()),defineProperty(assertThisInitialized(e),"_popperElement",React.createRef()),defineProperty(assertThisInitialized(e),"_document",null),defineProperty(assertThisInitialized(e),"_popper",null),defineProperty(assertThisInitialized(e),"handleEscape",(function(t){t.keyCode===KEY_ESC&&(e.props.opener.focus(),e.attemptClose())})),defineProperty(assertThisInitialized(e),"handleBlur",(function(t){var o=e.props,r=o.closeOnOpenerFocus,n=o.opener,s=t.relatedTarget;e._cardElement.current&&e._cardElement.current.contains(s)||r&&n&&n.contains(s)?!r||"BUTTON"!==n.tagName&&"INPUT"!==n.tagName||warn('Popover: using "closeOnOpenerFocus" with a <button> or <input> may lead to bugs due to cross-environment focus event handling. See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus for more information.'):(s||n.focus(),e.attemptClose())})),e}return createClass(o,[{key:"componentDidMount",value:function(){this._document=this._popperElement.current.ownerDocument,this._document.addEventListener("keydown",this.handleEscape),this.focus(),this.initPopper()}},{key:"componentWillUnmount",value:function(){this.destroyPopper(),this._document.removeEventListener("keydown",this.handleEscape),delete this._document,delete this._popper}},{key:"componentDidUpdate",value:function(e,t){var o=this.props,r=o.placement,n=o.children,s=o.opener;e.placement===r&&e.children===n&&e.opener===s||(this.destroyPopper(),this.initPopper())}},{key:"focus",value:function(){this._cardElement.current&&this._cardElement.current.focus()}},{key:"getPopperSettings",value:function(){var e=this.props,t=e.placement,o={placement:t,modifiers:{preventOverflow:{enabled:!0,padding:10,boundariesElement:e.rootBoundary||"window"}},positionFixed:!1};return"center"!==t?o:_objectSpread(_objectSpread({},o),{},{placement:"top-start",modifiers:_objectSpread(_objectSpread({},o.modifiers),{},{arrow:{enabled:!1},flip:{enabled:!1},offset:{enabled:!0,offset:"50% - 50%p, -50%p - 50%"}})})}},{key:"initPopper",value:function(){var e=this.props.opener;this._popper||(this._popper=new Popper(e,this._popperElement.current,this.getPopperSettings()))}},{key:"destroyPopper",value:function(){this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"attemptClose",value:function(){!1===this.props.onClose()&&this.focus()}},{key:"boundaryDimensions",value:function(){var e=this.props.rootBoundary,t="undefined"!=typeof window;return e?[e.clientWidth,e.clientHeight]:[t?window.innerWidth:0,t?window.innerHeight:0]}},{key:"render",value:function(){var e=this.props,t=e.children,o=e.theme,r=e.transitionStyles,n=e.zIndex,s=r.scale,i=r.opacity,p=this.boundaryDimensions(),a=slicedToArray(p,2),l=a[0],c=a[1];return React.createElement(_StyledAnimatedDiv,{ref:this._popperElement,style:{zIndex:n}},React.createElement(_StyledAnimatedDiv2,_extends_1({tabIndex:"0",onBlur:this.handleBlur,ref:this._cardElement,style:{opacity:i,transform:s.interpolate((function(e){return"scale3d(".concat(e,", ").concat(e,", 1)")})),maxHeight:"".concat(c-2*GU,"px"),maxWidth:"".concat(l-2*GU,"px")}},stylingProps(this),{_css:o.surface,_css2:o.border}),t))}}]),o}(React.Component);function Popover(e){var t=e.scaleEffect,o=e.visible,r=objectWithoutProperties(e,["scaleEffect","visible"]),n=useTheme(),s=useRoot();return React.createElement(RootPortal,null,React.createElement(Transition,{items:o,config:springs.swift,from:{scale:t?.9:1,opacity:0},enter:{scale:1,opacity:1},leave:{scale:t?.9:1,opacity:0},native:!0},(function(e){return e&&function(e){return React.createElement(PopoverBase,_extends_1({},r,{rootBoundary:s,theme:n,transitionStyles:e}))}})))}defineProperty(PopoverBase,"propTypes",{children:ExtendedPropTypes.node,closeOnOpenerFocus:ExtendedPropTypes.bool,onClose:ExtendedPropTypes.func,opener:ExtendedPropTypes._element,placement:ExtendedPropTypes.oneOf((_ref3=["center"]).concat.apply(_ref3,toConsumableArray(["auto","top","right","bottom","left"].map((function(e){return[e,"".concat(e,"-start"),"".concat(e,"-end")]}))))),rootBoundary:ExtendedPropTypes._element,theme:ExtendedPropTypes.object,transitionStyles:ExtendedPropTypes.object,zIndex:ExtendedPropTypes.number}),defineProperty(PopoverBase,"defaultProps",{closeOnOpenerFocus:!1,opener:null,placement:"center",onClose:noop,zIndex:999}),Popover.propTypes=_objectSpread(_objectSpread({},PopoverBase.propTypes),{},{scaleEffect:ExtendedPropTypes.bool,visible:ExtendedPropTypes.bool}),Popover.defaultProps=_objectSpread(_objectSpread({},PopoverBase.defaultProps),{},{scaleEffect:!0,visible:!0});export default Popover;