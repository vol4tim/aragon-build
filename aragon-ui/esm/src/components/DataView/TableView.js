import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useState,useCallback,useMemo}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import{animated as extendedAnimated,Transition}from"../../../node_modules/react-spring/web.js";import{useLayout}from"../Layout/Layout.js";import CheckBoxWithTheme from"../Input/Checkbox.js";import{ToggleButton}from"./ToggleButton.js";import{OpenedSurfaceBorder}from"./OpenedSurfaceBorder.js";import{useTheme}from"../../theme/Theme2.js";import{GU}from"../../style/constants.js";import{textStyle}from"../../style/text-styles.js";import{springs}from"../../style/springs.js";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function headingsFromFields(e,t){var n=t.hasAnyActions,r=t.hasAnyExpansion,o=t.selectContent,i=t.selectable,s=e.map((function(e,t){return[e.label,"end"===e.align?"right":"left"]}));return(r||i)&&s.unshift([i?o:null,"left"]),n&&s.push([null,"left"]),s.every((function(e){return!e[0]}))?null:s}function cellsFromEntry(e,t){var n=t.fields,r=t.hasAnyActions,o=t.hasAnyExpansion,i=t.hasExpansion,s=t.selectContent,a=t.selectable,l=t.toggleChildContent,c=e.entryNodes.map((function(e,t){return[e,n[t].align,!1]}));return a&&c.unshift([s,"start",!0]),!a&&o&&c.unshift([i&&l,"start",!0]),r&&c.push([e.actions,"end",!0]),c}var _StyledTable=_styled("table").withConfig({displayName:"TableView___StyledTable",componentId:"aczwu3-0"})(["width:100%;border-spacing:0;border-collapse:separate;"]);function TableView(e){var t=e.alignChildOnField,n=e.allSelected,r=e.entries,o=e.fields,i=e.hasAnyActions,s=e.hasAnyExpansion,a=e.onSelect,l=e.onSelectAll,c=e.renderSelectionCount,d=e.rowHeight,u=e.selectable,p=e.selectedCount,y=useState(-1),m=slicedToArray(y,2),f=m[0],h=m[1],_=useCallback((function(e){h((function(t){return t===e?-1:e}))}),[]),g=useMemo((function(){return headingsFromFields(o,{hasAnyActions:i,hasAnyExpansion:s,selectContent:React.createElement(CheckBoxWithTheme,{indeterminate:0===n,checked:n>-1,onChange:l}),selectable:u})}),[o,i,s,n,l,u]);return React.createElement(_StyledTable,null,g&&React.createElement("thead",null,React.createElement(HeadRow,{cells:g,selectedCount:p,renderSelectionCount:c})),React.createElement("tbody",null,r.map((function(e,n){return React.createElement(Entry,{key:e.index,alignChildOnField:t,entry:e,fields:o,firstRow:0===n,hasAnyActions:i,hasAnyExpansion:s,onSelect:a,onToggle:_,opened:f===e.index,rowHeight:d,selectable:u})}))))}function useSidePadding(){return"small"===useLayout().layoutName?2*GU:3*GU}TableView.propTypes={alignChildOnField:propTypes.number.isRequired,allSelected:propTypes.oneOf([-1,0,1]).isRequired,entries:propTypes.array.isRequired,fields:propTypes.array.isRequired,hasAnyActions:propTypes.bool.isRequired,hasAnyExpansion:propTypes.bool.isRequired,onSelect:propTypes.func.isRequired,onSelectAll:propTypes.func.isRequired,renderSelectionCount:propTypes.func.isRequired,rowHeight:propTypes.number.isRequired,selectable:propTypes.bool.isRequired,selectedCount:propTypes.number.isRequired};var _StyledTh=_styled("th").withConfig({displayName:"TableView___StyledTh",componentId:"aczwu3-1"})(["height:","px;padding:0;padding-left:","px;padding-right:","px;text-align:",";",";color:",";border-bottom:1px solid ",";"],(function(e){return e._css}),(function(e){return e._css2}),(function(e){return e._css3}),(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6}),(function(e){return e._css7}));function HeadRow(e){var t=e.cells,n=e.selectedCount,r=e.renderSelectionCount,o=useTheme(),i=useSidePadding();return React.createElement("tr",null,t.map((function(e,s){var a=n>0&&s>1,l=n>0&&1===s?r(n):e[0];return!a&&React.createElement(_StyledTh,{key:s,colSpan:n>0&&1===s?t.length-1:1,_css:4*GU,_css2:0===s?i:0,_css3:s===t.length-1?i:0,_css4:e[1],_css5:textStyle("label2"),_css6:o.surfaceContentSecondary,_css7:o.border},l)})))}var Entry=React.memo((function(e){var t=e.alignChildOnField,n=e.entry,r=e.fields,o=e.firstRow,i=e.hasAnyActions,s=e.hasAnyExpansion,a=e.onSelect,l=e.onToggle,c=e.opened,d=e.rowHeight,u=e.selectable,p=n.expansion.content.length>0,y=n.index,m=useCallback((function(){l(y)}),[y,l]),f=useCallback((function(e){a(y,e)}),[y,a]),h=cellsFromEntry(n,{fields:r,hasAnyActions:i,hasAnyExpansion:s,hasExpansion:p,selectable:u,toggleChildContent:s?React.createElement(Toggle,{opened:c,onToggle:m}):null,selectContent:u?React.createElement(CheckBoxWithTheme,{onChange:f,checked:n.selected}):null});return React.createElement(React.Fragment,null,React.createElement(EntryRow,{cells:h,firstRow:o,rowHeight:d,selected:n.selected}),p&&React.createElement(EntryExpansion,{alignChildOnCell:t+1,cellsCount:h.length,expansion:n.expansion,opened:c,rowHeight:d}))})),_StyledTr=_styled("tr").withConfig({displayName:"TableView___StyledTr",componentId:"aczwu3-2"})(["transition:background 150ms ease-in-out;background:",";"],(function(e){return e._css8})),_StyledTd=_styled("td").withConfig({displayName:"TableView___StyledTd",componentId:"aczwu3-3"})(["position:relative;width:",";height:","px;padding-top:0;padding-bottom:0;padding-left:","px;padding-right:","px;border-top:",";"],(function(e){return e._css9}),(function(e){return e._css10}),(function(e){return e._css11}),(function(e){return e._css12}),(function(e){return e._css13})),_StyledDiv=_styled("div").withConfig({displayName:"TableView___StyledDiv",componentId:"aczwu3-4"})(["display:flex;width:100%;justify-content:",";"],(function(e){return e._css14}));function EntryRow(e){var t=e.firstRow,n=e.cells,r=e.selected,o=e.rowHeight;e.mode;var i=useTheme(),s=useSidePadding();return React.createElement(_StyledTr,{_css8:r?i.surfaceSelected:"none"},n.map((function(e,n,r){var a=slicedToArray(e,3),l=a[0],c=a[1],d=a[2],u=0===n,p=n===r.length-1;return React.createElement(_StyledTd,{key:n,_css9:d?"1px":"auto",_css10:o,_css11:u||d?s:0,_css12:!u&&("end"!==c||p)||d?s:0,_css13:t?"0":"1px solid ".concat(i.border)},React.createElement(_StyledDiv,{_css14:"flex-".concat(c)},l))})))}var _StyledTr2=_styled("tr").withConfig({displayName:"TableView___StyledTr2",componentId:"aczwu3-5"})(["td{position:relative;padding:0;box-shadow:inset 0 6px 4px -4px rgba(0,0,0,0.16);background:",";}"],(function(e){return e._css15})),_StyledAnimatedDiv=_styled(extendedAnimated.div).withConfig({displayName:"TableView___StyledAnimatedDiv",componentId:"aczwu3-6"})(["overflow:hidden"]),_StyledDiv2=_styled("div").withConfig({displayName:"TableView___StyledDiv2",componentId:"aczwu3-7"})(["height:",";border-top:1px solid ",";"],(function(e){return e._css16}),(function(e){return e._css17})),_StyledAnimatedDiv2=_styled(extendedAnimated.div).withConfig({displayName:"TableView___StyledAnimatedDiv2",componentId:"aczwu3-8"})(["overflow:hidden"]),_StyledDiv3=_styled("div").withConfig({displayName:"TableView___StyledDiv3",componentId:"aczwu3-9"})(["display:flex;align-items:center;height:",";padding-left:","px;padding-right:","px;border-top:1px solid ",";"],(function(e){return e._css18}),(function(e){return e._css19}),(function(e){return e._css20}),(function(e){return e._css21}));function EntryExpansion(e){var t=e.alignChildOnCell,n=e.cellsCount,r=e.expansion,o=e.opened,i=e.rowHeight,s=useTheme(),a=useState(0),l=slicedToArray(a,2),c=l[0],d=l[1],u=function(e){e&&d(e.getBoundingClientRect().height)},p=r.freeLayout?c:i*r.content.length;return React.createElement(Transition,{native:!0,unique:!0,items:o,from:{height:0},enter:{height:p},update:{height:p},leave:{height:0},config:_objectSpread(_objectSpread({},springs.smooth),{},{precision:.1})},(function(e){return e&&function(e){var a=e.height;return React.createElement(_StyledTr2,{_css15:s.surfaceUnder},t>0&&React.createElement("td",{colSpan:t},React.createElement(OpenedSurfaceBorder,{opened:o}),React.createElement(_StyledAnimatedDiv,{style:{height:a.interpolate((function(e){return e!==p?"".concat(e,"px"):"auto"}))}},r.content.map((function(e,t){return React.createElement(_StyledDiv2,{key:t,_css16:r.freeLayout?"auto":"".concat(i,"px"),_css17:s.border})})))),React.createElement("td",{colSpan:-1===t?n:n-t},0===t&&React.createElement(OpenedSurfaceBorder,{opened:o}),React.createElement(_StyledAnimatedDiv2,{style:{height:a.interpolate((function(e){return e!==p?"".concat(e,"px"):"auto"}))}},r.content.map((function(e,n){return React.createElement(_StyledDiv3,{key:n,ref:r.freeLayout?u:null,_css18:r.freeLayout?"auto":"".concat(i,"px"),_css19:t<1?3*GU:0,_css20:3*GU,_css21:s.border},e)})))))}}))}var _StyledDiv4=_styled("div").withConfig({displayName:"TableView___StyledDiv4",componentId:"aczwu3-10"})(["width:100%;height:100%;"]),Toggle=React.memo((function(e){var t=e.opened,n=e.onToggle;return React.createElement(_StyledDiv4,null,React.createElement(OpenedSurfaceBorder,{opened:t}),React.createElement(ToggleButton,{opened:t,onClick:n}))}));export{TableView};