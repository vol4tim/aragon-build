import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import toConsumableArray from"../../../node_modules/@babel/runtime/helpers/toConsumableArray.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useState,useCallback,useEffect,useMemo}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import Box from"../Box/Box.js";import Pagination from"../Pagination/Pagination.js";import{useLayout}from"../Layout/Layout.js";import{TableView}from"./TableView.js";import{ListView}from"./ListView.js";import EmptyState from"./EmptyState.js";import{useTheme}from"../../theme/Theme2.js";import{warnOnce}from"../../utils/environment.js";import{GU}from"../../style/constants.js";import{textStyle}from"../../style/text-styles.js";import{noop}from"../../utils/miscellaneous.js";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function prepareEntries(e,t,n,r){return e.slice(t,n).map((function(e,n){var o=t+n;return{value:e||null,index:o,selected:r.includes(o)}}))}function prepareFields(e){return e.map((function(e,t,n){var r=e&&e.label?e:{label:e};return r.align||(r.align=t===n.length-1&&n.length>1?"end":"start"),r}))}function entryExpansion(e){return Array.isArray(e)&&e.length>0?{content:e,freeLayout:!1}:e&&!Array.isArray(e)?{content:[e],freeLayout:!0}:{content:[],freeLayout:!1}}function renderEntries(e,t){var n=t.fields,r=t.renderEntry,o=t.renderEntryActions,a=t.renderEntryExpansion,s=t.mode;return e.map((function(e){var t=e.value,i=e.index,l=e.selected,p=r(t,i,{selected:l,mode:s});for(Array.isArray(p)||(p=[]);p.length<n.length;)p.push(null);var c=entryExpansion(a?a(t,i,{selected:l,mode:s}):null);return{actions:o?o(t,i,{selected:l,mode:s}):null,entryNodes:p,expansion:c,index:i,selected:l}}))}function useSelection(e,t,n){var r=useState([]),o=slicedToArray(r,2),a=o[0],s=o[1],i=void 0===t?a:t,l=useCallback((function(r){void 0===t&&s(r),n(toConsumableArray(r).sort().map((function(t){return e[t]})),r)}),[t,n,e]),p=useMemo((function(){return 0===i.length?-1:i.length===e.length?1:0}),[e,i]),c=useCallback((function(e){l(i.includes(e)?i.filter((function(t){return t!==e})):[].concat(toConsumableArray(i),[e]))}),[l,i]);return{allSelected:p,selectAll:useCallback((function(){l(0===i.length?e.map((function(e,t){return t})):[])}),[e,i,l]),toggleEntrySelect:c,selectedIndexes:i}}function deprecatedEmptyStatePropsCompat(e){for(var t=e.emptyState,n=e.statusEmpty,r=e.statusLoading,o=0,a=[["statusEmpty",n,"default","title"],["statusEmptyFilters",e.statusEmptyFilters,"empty-filters","subtitle"],["statusEmptySearch",e.statusEmptySearch,"empty-search","subtitle"],["statusLoading",r,"loading","title"]];o<a.length;o++){var s=slicedToArray(a[o],4),i=s[0],l=s[1],p=s[2],c=s[3];l&&(warnOnce("DataView:".concat(i),"DataView: the ".concat(i," prop is now deprecated, please use emptyState instead.")),t[p]&&t[p][c]||(t[p]=_objectSpread(_objectSpread({},t[p]),{},defineProperty({},c,l))))}return t}var _StyledDiv=_styled("div").withConfig({displayName:"DataView___StyledDiv",componentId:"sc-49otbs-0"})(["padding:","px ","px;"],(function(e){return e._css}),(function(e){return e._css2})),_StyledH=_styled("h1").withConfig({displayName:"DataView___StyledH",componentId:"sc-49otbs-1"})(["margin-bottom:","px;",";"],(function(e){return e._css3}),(function(e){return e._css4})),_StyledDiv2=_styled("div").withConfig({displayName:"DataView___StyledDiv2",componentId:"sc-49otbs-2"})(["border-top:1px solid ",";"],(function(e){return e._css5})),DataView=React.memo((function(e){var t=e.emptyState,n=e.entries,r=e.entriesPerPage,o=e.fields,a=e.heading,s=e.mode,i=e.onPageChange,l=e.onSelectEntries,p=e.onStatusEmptyClear,c=e.page,d=e.renderEntry,u=e.renderEntryActions,y=e.renderEntryExpansion,m=e.renderSelectionCount,f=e.selection,E=e.status,g=e.tableRowHeight,h=e.renderEntryChild,b=e.statusEmpty,S=e.statusEmptyFilters,w=e.statusEmptySearch,T=e.statusLoading;h&&!y&&(warnOnce("DataView:renderEntryChild","DataView: the renderEntryChild prop has been renamed renderEntryExpansion and will be removed in a future version. Please use the new name."),y=h),y&&l&&(warnOnce("DataView: renderEntryExpansion + onSelectEntries","A DataView cannot be made selectable with some of its entries expandable. Please use only one of renderEntryExpansion or onSelectEntries at a time. Ignoring renderEntryExpansion."),y=void 0),t=deprecatedEmptyStatePropsCompat({emptyState:t,statusEmpty:b,statusEmptyFilters:S,statusEmptySearch:w,statusLoading:T});var v=useState(0),_=slicedToArray(v,2),x=_[0],C=_[1],j=useCallback((function(e){void 0===c&&C(e),i(e)}),[i,c]);useEffect((function(){C(0)}),[n]);var P=void 0===c?x:c,A=useTheme(),O=useLayout().layoutName,D="list"===s||"table"!==s&&"small"===O,V=useSelection(n,f,l),R=V.allSelected,L=V.selectAll,F=V.toggleEntrySelect,H=V.selectedIndexes,B=Boolean(u),I=Boolean(y),k=Boolean(l);r<1&&(r=n.length);var G=Math.ceil(n.length/r),M=r*P,U=prepareEntries(n,M,M+r,H),N=prepareFields(o),q=renderEntries(U,{fields:o,renderEntry:d,renderEntryActions:u,renderEntryExpansion:y,mode:D?"list":"table"}),K=o.findIndex((function(e){return e&&e.childStart})),z=0===q.length;return React.createElement(Box,{padding:0},a&&React.createElement(_StyledDiv,{_css:2*GU,_css2:"small"===O?2*GU:3*GU},"string"==typeof a?React.createElement(_StyledH,{_css3:2*GU,_css4:textStyle("body2")},a):a),!z&&(D?React.createElement(ListView,{allSelected:R,entries:q,fields:N,hasAnyExpansion:I,onSelect:F,onSelectAll:L,renderSelectionCount:m,rowHeight:g,selectable:k}):React.createElement(TableView,{alignChildOnField:Math.min(Math.max(-1,K),o.length-1),allSelected:R,entries:q,fields:N,hasAnyActions:B,hasAnyExpansion:I,onSelect:F,onSelectAll:L,renderSelectionCount:m,rowHeight:g,selectable:k,selectedCount:H.length})),z&&React.createElement(EmptyState,{status:E,configurator:t,onStatusEmptyClear:p}),G>1&&React.createElement(_StyledDiv2,{_css5:A.border},React.createElement(Pagination,{pages:G,selected:P,onChange:j,touchMode:"small"===O})))}));DataView.propTypes={page:propTypes.number,entries:propTypes.array.isRequired,entriesPerPage:propTypes.number,fields:propTypes.array.isRequired,heading:propTypes.node,mode:propTypes.oneOf(["adaptive","table","list"]),onPageChange:propTypes.func,onSelectEntries:propTypes.func,renderEntry:propTypes.func.isRequired,renderEntryActions:propTypes.func,renderEntryExpansion:propTypes.func,renderSelectionCount:propTypes.func,selection:propTypes.array,tableRowHeight:propTypes.number,status:propTypes.oneOf(["default","empty-filters","empty-search","loading"]),onStatusEmptyClear:propTypes.func,emptyState:propTypes.oneOfType([propTypes.func,propTypes.object]),renderEntryChild:propTypes.func,statusEmpty:propTypes.node,statusLoading:propTypes.node,statusEmptyFilters:propTypes.node,statusEmptySearch:propTypes.node},DataView.defaultProps={emptyState:{},entriesPerPage:10,mode:"adaptive",onPageChange:noop,renderSelectionCount:function(e){return"".concat(e," items selected")},status:"default",tableRowHeight:8*GU};export default DataView;