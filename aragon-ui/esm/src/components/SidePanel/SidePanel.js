import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import objectWithoutProperties from"../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js";import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import slicedToArray from"../../../node_modules/@babel/runtime/helpers/slicedToArray.js";import _styled from"styled-components";import React,{useCallback,useState,useEffect,useContext,useRef}from"react";import propTypes from"../../../node_modules/prop-types/index.js";import{animated as extendedAnimated,Transition}from"../../../node_modules/react-spring/web.js";import{Inside as i}from"../../../node_modules/use-inside/dist/index.js";import ButtonIcon from"../Button/ButtonIcon.js";import{useViewport}from"../../providers/Viewport/Viewport.js";import RootPortal from"../RootPortal/RootPortal.js";import{useTheme}from"../../theme/Theme2.js";import IconCross from"../../icons/components/IconCross.js";import{KEY_ESC}from"../../utils/keycodes.js";import{springs}from"../../style/springs.js";import{GU}from"../../style/constants.js";import{unselectable}from"../../utils/css.js";import{textStyle}from"../../style/text-styles.js";import{warn}from"../../utils/environment.js";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var CONTENT_PADDING=3*GU,CLOSING_POSITION=5*GU,SidePanelContext=React.createContext(null),_StyledDiv=_styled("div").withConfig({displayName:"SidePanel___StyledDiv",componentId:"sc-1kjx6mk-0"})(["position:absolute;z-index:1;top:0;left:0;right:0;bottom:0;pointer-events:",";overflow:hidden;"],(function(e){return e._css})),_StyledAnimatedDiv=_styled(extendedAnimated.div).withConfig({displayName:"SidePanel___StyledAnimatedDiv",componentId:"sc-1kjx6mk-1"})(["position:absolute;top:0;left:0;right:0;bottom:0;background:",";"],(function(e){return e._css2})),_StyledHeader=_styled("header").withConfig({displayName:"SidePanel___StyledHeader",componentId:"sc-1kjx6mk-2"})(["display:flex;flex-direction:column;justify-content:center;flex-shrink:0;position:relative;height:","px;padding-left:","px;border-bottom:1px solid ",";",";"],(function(e){return e._css3}),CONTENT_PADDING,(function(e){return e._css4}),(function(e){return e._css5})),_StyledH=_styled("h1").withConfig({displayName:"SidePanel___StyledH",componentId:"sc-1kjx6mk-3"})(["color:",";",";"],(function(e){return e._css6}),(function(e){return e._css7})),_StyledButtonIcon=_styled(ButtonIcon).withConfig({displayName:"SidePanel___StyledButtonIcon",componentId:"sc-1kjx6mk-4"})(["position:absolute;",""],(function(e){return e._css8})),_StyledDiv2=_styled("div").withConfig({displayName:"SidePanel___StyledDiv2",componentId:"sc-1kjx6mk-5"})(["overflow-y:auto;height:100%;display:flex;flex-direction:column;"]),_StyledDiv3=_styled("div").withConfig({displayName:"SidePanel___StyledDiv3",componentId:"sc-1kjx6mk-6"})(["min-height:0;flex-grow:1;flex-shrink:0;display:flex;flex-direction:column;width:100%;padding-right:","px;padding-left:","px;padding-bottom:","px;"],CONTENT_PADDING,CONTENT_PADDING,CONTENT_PADDING);function SidePanel(e){var t=e.blocking,n=e.children,o=e.opened,r=e.onClose,s=e.onTransitionEnd,c=e.title,l=useTheme(),a=(0,useViewport().below)("medium"),d=useCallback((function(){t||r()}),[t,r]),p=useCallback((function(e){e.keyCode===KEY_ESC&&o&&d()}),[o,d]),u=useState(o?"opened":"closed"),m=slicedToArray(u,2),f=m[0],y=m[1],_=useState(!1),S=slicedToArray(_,2),b=S[0],h=S[1],P=useCallback((function(){s(o),y(o?"opened":"closed")}),[o,s]),x=useCallback((function(){y(o?"opening":"closing")}),[o]),g=useCallback((function(e,t,n){var o=n.progress;o>.5&&!b?h(!0):o<.5&&b&&h(!1)}),[b]),v=useCallback((function(){h(!1)}),[]);return useEffect((function(){return document.addEventListener("keydown",p),function(){document.removeEventListener("keydown",p)}}),[p]),React.createElement(RootPortal,null,React.createElement(i,{name:"SidePanel"},React.createElement(Transition,{items:o,config:_objectSpread(_objectSpread({},springs.lazy),{},{precision:.001}),from:{progress:0},enter:{progress:Number(o)},leave:{progress:0},onRest:P,onStart:x,onFrame:g,onDestroyed:v,unique:!0,native:!0},(function(e){return e&&function(e){var o=e.progress;return React.createElement(_StyledDiv,{_css:"closing"!==f?"auto":"none"},React.createElement(_StyledAnimatedDiv,{onClick:d,style:{opacity:o,pointerEvents:"closing"!==f?"auto":"none"},_css2:l.overlay.alpha(.9)}),React.createElement(Panel,{compact:a,style:{transform:o.interpolate((function(e){return"\n                          translate3d(\n                            calc(\n                              ".concat(100*(1-e),"% +\n                              ").concat(CLOSING_POSITION*(1-e),"px\n                            ), 0, 0\n                          )\n                        ")}))}},React.createElement(_StyledHeader,{_css3:8*GU,_css4:l.border,_css5:unselectable()},React.createElement(_StyledH,{_css6:l.surfaceContent,_css7:textStyle("body1")},c),!t&&React.createElement(_StyledButtonIcon,{label:"Close",onClick:d,_css8:a?"\n                              top: 0;\n                              right: 0;\n                              height: ".concat(8*GU,"px;\n                              width: ").concat(8*GU,"px;\n                            "):"\n                              top: ".concat(2*GU,"px;\n                              right: ").concat(2*GU,"px;\n                            ")},React.createElement(IconCross,{color:l.surfaceIcon}))),React.createElement(_StyledDiv2,null,React.createElement(_StyledDiv3,null,React.createElement(SidePanelContext.Provider,{value:{status:f,readyToFocus:b}},n)))))}}))))}SidePanel.propTypes={blocking:propTypes.bool,children:propTypes.node.isRequired,opened:propTypes.bool,onClose:propTypes.func,onTransitionEnd:propTypes.func,title:propTypes.node.isRequired},SidePanel.defaultProps={opened:!0,blocking:!1,onClose:function(){},onTransitionEnd:function(){}};var _StyledAnimatedAside=_styled(extendedAnimated.aside).withConfig({displayName:"SidePanel___StyledAnimatedAside",componentId:"sc-1kjx6mk-7"})(["position:absolute;top:0;right:0;display:flex;flex-direction:column;width:100%;height:100%;background:",";box-shadow:-2px 0px 4px rgba(0,0,0,0.1);",""],(function(e){return e._css9}),(function(e){return e._css10})),Panel=React.memo((function(e){var t=e.compact,n=objectWithoutProperties(e,["compact"]),o=useTheme();return React.createElement(_StyledAnimatedAside,_extends_1({},n,{_css9:o.surface,_css10:t?"":"max-width: 450px;"}))}));function useSidePanel(){var e=useContext(SidePanelContext);if(null===e)throw new Error("useSidePanel() was used outside of the SidePanel render tree, which has to be declared at an upper level!");return e}function useSidePanelFocusOnReady(e){var t=useSidePanel().readyToFocus,n=useRef(),o=e||n;return useEffect((function(){t&&o.current&&(o.current.focus?o.current.focus():warn("useSidePanelFocusOnReady(): the focus() method wasnâ€™t available on the passed ref."))}),[t,o]),o}Panel.propTypes={compact:propTypes.bool},SidePanel.HORIZONTAL_PADDING=CONTENT_PADDING;export default SidePanel;export{useSidePanel,useSidePanelFocusOnReady};