import _extends_1 from"../../../node_modules/@babel/runtime/helpers/extends.js";import classCallCheck from"../../../node_modules/@babel/runtime/helpers/classCallCheck.js";import createClass from"../../../node_modules/@babel/runtime/helpers/createClass.js";import assertThisInitialized from"../../../node_modules/@babel/runtime/helpers/assertThisInitialized.js";import inherits from"../../../node_modules/@babel/runtime/helpers/inherits.js";import possibleConstructorReturn from"../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js";import getPrototypeOf from"../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js";import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import toConsumableArray from"../../../node_modules/@babel/runtime/helpers/toConsumableArray.js";import _styled from"styled-components";import React from"react";import propTypes from"../../../node_modules/prop-types/index.js";import memoize_1 from"../../../node_modules/lodash/memoize.js";import dayjs_min from"../../../node_modules/dayjs/dayjs.min.js";import{formatHtmlDatetime,difference}from"../../utils/date.js";import{useTheme}from"../../theme/Theme2.js";import IconClock from"../../icons/components/IconClock.js";import{Redraw}from"../../providers/Redraw/Redraw.js";import{textStyle}from"../../style/text-styles.js";import{unselectable}from"../../utils/css.js";import{GU}from"../../style/constants.js";function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=getPrototypeOf(e);if(t){var s=getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return possibleConstructorReturn(this,n)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var RENDER_EVERY=1e3,formatUnit=function(e){return String(e).padStart(2,"0")},formats={yMdhms:"yMdhms",yMdhm:"yMdhm",yMdh:"yMdh",yMd:"yMd",yM:"yM",Mdhms:"Mdhms",Mdhm:"Mdhm",Mdh:"Mdh",Md:"Md",dhms:"dhms",dhm:"dhm",hms:"hms",hm:"hm",ms:"ms",m:"m",s:"s"},unitNames={y:"years",M:"months",d:"days",h:"hours",m:"minutes",s:"seconds"},getFormat=memoize_1((function(e){return["y","M","d","h","m","s"].reduce((function(t,n){return formats[e].includes(n)?[].concat(toConsumableArray(t),[unitNames[n]]):t}),[])}));function getTime(e,t,n,r,s){var o=t||new Date,a=t?new Date:e,i=dayjs_min(o).diff(a,"seconds"),m=difference(o,a,{keepLeadingZeros:r,maxUnits:s,units:getFormat(n)});return{units:[["Y",m.years],["M",m.months],["D",m.days],["H",m.hours],["M",m.minutes],["S",m.seconds]],totalInSeconds:i}}var _StyledTime=_styled("time").withConfig({displayName:"Timer___StyledTime",componentId:"sc-58hkwl-0"})(["display:flex;align-items:center;white-space:nowrap;",";",";"],(function(e){return e._css}),(function(e){return e._css2})),_StyledSpan=_styled("span").withConfig({displayName:"Timer___StyledSpan",componentId:"sc-58hkwl-1"})(["display:flex;align-items:center;margin-right:","px;margin-top:-3px;"],(function(e){return e._css3})),_StyledIconTime=_styled(IconClock).withConfig({displayName:"Timer___StyledIconTime",componentId:"sc-58hkwl-2"})(["color:",";"],(function(e){return e._css4})),_StyledSpan2=_styled("span").withConfig({displayName:"Timer___StyledSpan2",componentId:"sc-58hkwl-3"})(["",";color:",";"],(function(e){return e._css5}),(function(e){return e._css6})),_StyledSpan3=_styled("span").withConfig({displayName:"Timer___StyledSpan3",componentId:"sc-58hkwl-4"})(["color:",";",";"],(function(e){return e._css7}),(function(e){return e._css8})),_StyledSpan4=_styled("span").withConfig({displayName:"Timer___StyledSpan4",componentId:"sc-58hkwl-5"})(["margin-left:2px;color:",";"],(function(e){return e._css9})),_StyledSpan5=_styled("span").withConfig({displayName:"Timer___StyledSpan5",componentId:"sc-58hkwl-6"})(["margin:0 4px;color:",";font-weight:400;"],(function(e){return e._css10})),Timer=function(e){inherits(n,e);var t=_createSuper(n);function n(){var e;classCallCheck(this,n);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return e=t.call.apply(t,[this].concat(s)),defineProperty(assertThisInitialized(e),"renderTime",(function(){var t=e.props,n=t.start,r=t.end,s=t.theme,o=getTime(n,r,t.format,t.showEmpty,t.maxUnits),a=o.totalInSeconds,i=o.units;if(a<0||Object.is(a,-0))return React.createElement(_StyledSpan2,{_css5:textStyle("body2"),_css6:s.surfaceContentSecondary},r?"Time out":"âˆ’");var m=i.reduce((function(e,t,n){return null===t[1]?e:n}),0);return React.createElement("span",null,i.map((function(e,t){var n=t===m,r=t===i.length-1,o=t>=i.length-3;return null===e[1]?null:React.createElement(React.Fragment,{key:t},React.createElement(_StyledSpan3,{_css7:s.surfaceContent,_css8:r&&"\n                      display: inline-flex;\n                      align-items: baseline;\n                      justify-content: space-between;\n                      min-width: 31px;\n                    "},formatUnit(e[1]),React.createElement(_StyledSpan4,{_css9:s.surfaceContentSecondary},e[0])),!n&&React.createElement(_StyledSpan5,{_css10:s.surfaceContentSecondary},o&&":"))})))})),e}return createClass(n,[{key:"render",value:function(){var e=this.props,t=e.end,n=e.start,r=e.showIcon,s=e.theme;return React.createElement(_StyledTime,{dateTime:formatHtmlDatetime(t||n),_css:unselectable(),_css2:textStyle("body2")},r&&React.createElement(_StyledSpan,{_css3:.5*GU},React.createElement(_StyledIconTime,{_css4:s.surfaceIcon})),React.createElement(Redraw,{interval:RENDER_EVERY},this.renderTime))}}]),n}(React.Component);defineProperty(Timer,"propTypes",{end:propTypes.instanceOf(Date),format:propTypes.oneOf(Object.keys(formats)),maxUnits:propTypes.number,showEmpty:propTypes.bool,showIcon:propTypes.bool,start:propTypes.instanceOf(Date),theme:propTypes.object}),defineProperty(Timer,"defaultProps",{format:formats.yMdhms,maxUnits:-1,showEmpty:!1,showIcon:!0});var Timer$1=function(e){var t=useTheme();return React.createElement(Timer,_extends_1({},e,{theme:t}))};export default Timer$1;