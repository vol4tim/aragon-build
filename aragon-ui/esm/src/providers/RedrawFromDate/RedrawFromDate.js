import classCallCheck from"../../../node_modules/@babel/runtime/helpers/classCallCheck.js";import createClass from"../../../node_modules/@babel/runtime/helpers/createClass.js";import assertThisInitialized from"../../../node_modules/@babel/runtime/helpers/assertThisInitialized.js";import inherits from"../../../node_modules/@babel/runtime/helpers/inherits.js";import possibleConstructorReturn from"../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js";import getPrototypeOf from"../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js";import defineProperty from"../../../node_modules/@babel/runtime/helpers/defineProperty.js";import React from"react";import propTypes from"../../../node_modules/prop-types/index.js";import getDisplayName from"../../../node_modules/react-display-name/lib/getDisplayName.js";import dayjs_min from"../../../node_modules/dayjs/dayjs.min.js";import{difference}from"../../utils/date.js";function _createSuper(e){var r=_isNativeReflectConstruct();return function(){var t,a=getPrototypeOf(e);if(r){var o=getPrototypeOf(this).constructor;t=Reflect.construct(a,arguments,o)}else t=a.apply(this,arguments);return possibleConstructorReturn(this,t)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var EVERY_SECOND=1e3,EVERY_MINUTE=60*EVERY_SECOND,EVERY_HOUR=60*EVERY_MINUTE,getRedrawTime=function(e){var r=difference(new Date,e),t=r.days,a=r.hours,o=r.minutes;return a||t?EVERY_HOUR:o>1?EVERY_MINUTE:EVERY_SECOND},RedrawFromDate=function(e){inherits(t,e);var r=_createSuper(t);function t(){var e;classCallCheck(this,t);for(var a=arguments.length,o=new Array(a),n=0;n<a;n++)o[n]=arguments[n];return e=r.call.apply(r,[this].concat(o)),defineProperty(assertThisInitialized(e),"state",{redrawTime:EVERY_HOUR,lastDraw:-1}),defineProperty(assertThisInitialized(e),"clearInterval",(function(){e.interval&&clearInterval(e.interval)})),defineProperty(assertThisInitialized(e),"restartDrawInterval",(function(r){e.clearInterval(),e.interval=setInterval((function(){e.setState({lastDraw:Date.now()});var t=getRedrawTime(e.props.fromDate);t!==r&&e.restartDrawInterval(t)}),r)})),e}return createClass(t,[{key:"componentDidMount",value:function(){var e=this.props.fromDate;e&&this.restartDrawInterval(getRedrawTime(e))}},{key:"componentWillReceiveProps",value:function(e){var r=e.fromDate;!r&&this.props.fromDate?this.clearInterval():dayjs_min(r).isSame(this.props.fromDate)||this.restartDrawInterval(getRedrawTime(this.props.fromDate))}},{key:"componentWillUnmount",value:function(){this.clearInterval()}},{key:"render",value:function(){return this.props.children()}}]),t}(React.Component);defineProperty(RedrawFromDate,"propTypes",{children:propTypes.func.isRequired,fromDate:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.instanceOf(Date)]).isRequired});var hocWrap=function(e){var r=function(r){return React.createElement(RedrawFromDate,{fromDate:r.fromDate},(function(){return React.createElement(e,r)}))};return r.propTypes={fromDate:RedrawFromDate.propTypes.fromDate},r.displayName="RedrawFromDate(".concat(getDisplayName(e),")"),r};RedrawFromDate.hocWrap=hocWrap;export default RedrawFromDate;export{RedrawFromDate,hocWrap};